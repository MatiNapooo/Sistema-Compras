{% extends 'core/base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<style>
    /* Specific styles for invoice to ensure printabilty and modern look */
    .invoice-container {
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        max-width: 900px;
        margin: 0 auto;
        color: #333;
        font-family: 'Poppins', sans-serif;
    }

    .invoice-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        border-bottom: 2px solid #eee;
        padding-bottom: 20px;
        margin-bottom: 30px;
    }

    .company-logo img {
        height: 80px;
        /* Adjusted size */
        margin-bottom: 10px;
    }

    .company-info p {
        margin: 2px 0;
        font-size: 13px;
        color: #666;
    }

    .invoice-title {
        text-align: right;
    }

    .invoice-title h2 {
        font-size: 24px;
        color: var(--blue);
        margin: 0 0 5px 0;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .invoice-title .po-number {
        font-size: 18px;
        color: #d32f2f;
        /* Red used in example */
        font-weight: bold;
    }

    .invoice-meta {
        margin-top: 15px;
        font-size: 14px;
        text-align: right;
    }

    .invoice-details {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
    }

    .detail-group h4 {
        font-size: 14px;
        color: #999;
        text-transform: uppercase;
        margin-bottom: 5px;
    }

    .detail-group p {
        font-size: 16px;
        font-weight: 500;
        margin: 0;
    }

    .invoice-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
    }

    .invoice-table th {
        background-color: var(--blue);
        color: white;
        padding: 12px;
        text-align: left;
        font-size: 13px;
        font-weight: 500;
        text-transform: uppercase;
    }

    .invoice-table td {
        padding: 15px 12px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }

    .invoice-table tr:last-child td {
        border-bottom: none;
    }

    .totals-section {
        display: flex;
        justify-content: flex-end;
    }

    .totals-table {
        width: 300px;
        border-collapse: collapse;
    }

    .totals-table td {
        padding: 10px;
        text-align: right;
        border-bottom: 1px solid #eee;
    }

    .totals-table tr.final-total td {
        font-size: 18px;
        font-weight: bold;
        color: var(--dark);
        border-top: 2px solid var(--dark);
        border-bottom: none;
    }

    .print-btn {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        background: var(--blue);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }

    @media print {

        /* Hide everything by default, then show invoice */
        #sidebar,
        nav,
        .print-btn {
            display: none !important;
        }

        body,
        #content {
            background: white !important;
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            left: 0 !important;
        }

        .invoice-container {
            width: 100% !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 0 !important;
            box-shadow: none !important;
            border: none !important;
        }

        /* Force table borders for printing */
        .invoice-table,
        .invoice-table th,
        .invoice-table td {
            border: 1px solid #000 !important;
        }

        .invoice-table th {
            color: #000 !important;
            /* Force black text for headers */
            font-weight: bold !important;
        }

        /* Adjust spacing for print */
        .invoice-table td,
        .invoice-table th {
            padding: 8px !important;
        }
    }
</style>

<div class="invoice-container">
    <!-- Header -->
    <div class="invoice-header">
        <div class="company-section">
            <div class="company-logo">
                <img src="{% static 'img/logo_nextprint.jpeg' %}" alt="Next Print">
            </div>
            <div class="company-info">
                <p><strong>NEXT PRINT SA</strong></p>
                <p>Santo Domingo 2615 (C1293AGE) Ciudad de Buenos Aires</p>
                <p>info@nextprint.com.ar</p>
                <p>Tel. +54 11 7531 3801</p>
            </div>
        </div>
        <div class="invoice-title">
            <h2>Orden de Compra</h2>
            <!-- PO Number removed as requested -->
            <div class="invoice-meta">
                <p><strong>Fecha:</strong> {{ compra.fecha|date:"d/m/Y" }}</p>
                <p><strong>Solicitante:</strong> {{ compra.pedido_por }}</p>
            </div>
        </div>
    </div>

    <!-- Vendor Details -->
    <div class="invoice-details">
        <div class="detail-group">
            <h4>Proveedor</h4>
            <p>{{ compra.proveedor }}</p>
            <!-- Contact removed as requested -->
        </div>
        <div class="detail-group" style="text-align: right;">
            <h4>Enviar a</h4>
            <p>Next Print SA</p>
            <p>Santo Domingo 2615</p>
            <p>07:00 a 16:00 hs.</p>
        </div>
    </div>

    <!-- Table -->
    <table class="invoice-table">
        <thead>
            <tr>
                <th style="width: 8%;">Cant.</th>
                <th style="width: 10%;">Unidad</th>
                <th style="width: {% if parsed.is_paper %}20%{% else %}38%{% endif %};">Insumo</th>
                <th style="width: 25%;">Observaciones</th>
                {% if parsed.is_paper %}
                <th style="width: 10%;">Formato</th>
                <th style="width: 8%;">Gramaje</th>
                {% endif %}
                <th style="width: 10%; text-align: right;">P. Unitario</th>
                <th style="width: 10%; text-align: right;">P. Total</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align: center;">{{ parsed.qty }}</td>
                <td style="text-align: center;">{% if parsed.is_paper %}Resmas{% else %}Unidad{% endif %}</td>
                <td>
                    {{ parsed.tipo }}
                    {% if not parsed.is_paper and compra.marca and compra.marca != '-' %}
                    <br><small style="color: #666;">Marca: {{ compra.marca }}</small>
                    {% endif %}
                </td>
                <td>{{ compra.observaciones|default:"-" }}</td>
                {% if parsed.is_paper %}
                <td style="text-align: center;">{{ parsed.ancho }} x {{ parsed.alto }}</td>
                <td style="text-align: center;">{{ parsed.gramaje }}</td>
                {% endif %}
                <td style="text-align: right;">$ {{ parsed.unit_price|floatformat:2|intcomma }}</td>
                <td style="text-align: right;">$ {{ compra.precio|floatformat:2|intcomma }}</td>
            </tr>
            <!-- Fill empty rows to look like the example? Optional, skipping for now to keep it clean -->
        </tbody>
    </table>

    <!-- Totals -->
    <div class="totals-section">
        <table class="totals-table">
            <tr>
                <td>SUBTOTAL</td>
                <td>$ {{ compra.precio|floatformat:2|intcomma }}</td>
            </tr>
            <tr>
                <td>IVA (21%)</td>
                <td>$ {{ iva|floatformat:2|intcomma }}</td>
            </tr>
            <tr class="final-total">
                <td>TOTAL</td>
                <td>$ {{ total_final|floatformat:2|intcomma }}</td>
            </tr>
        </table>
    </div>

    <button class="print-btn" onclick="window.print()">
        <i class='bx bx-printer'></i> Imprimir Orden
    </button>
</div>
{% endblock %}